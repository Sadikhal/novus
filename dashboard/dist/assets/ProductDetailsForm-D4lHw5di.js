import{r as o,f as O,u as Q,a as W,b as Y,g as G,j as e,I as m,h as H,c as J,o as P,i as A,d as u,s as i,n as h,k as K}from"./index-BeksSBPr.js";import{T as Z}from"./textarea-r3ViTS5Q.js";const ee=P({name:i().min(4,{message:"Product name must be at least 4 characters!"}).max(30,{message:"Product name must be at most 30 characters!"}),brandId:i().min(1,{message:"Brand is required!"}),actualPrice:h().min(.01,{message:"Invalid price!"}),sellingPrice:h().min(.01).optional(),category:u(i()).min(1,{message:"At least one category is required!"}),isAvailable:K().default(!0),desc:i().min(10,{message:"Description must be at least 10 characters!"}),deliveryDays:h().min(1,{message:"Delivery days must be at least 1!"}),size:i().min(1,{message:"Size is required!"}),color:u(i()).min(1,{message:"At least one color is required!"}),image:u(i()).min(1,"At least one image is required").max(5,"Maximum 5 images allowed"),features:u(P({name:i().min(1,"Feature name is required"),detail:i().min(1,"Feature detail is required")})).optional()}),re=({type:x,data:t})=>{const[I,k]=o.useState([]);O();const[b,y]=o.useState(!1),[ae,se]=o.useState(""),{toast:g}=Q(),[F,j]=o.useState([]),[V,v]=o.useState(!1),[d,N]=o.useState(t?.image||[]),w=o.useRef(null),{register:r,handleSubmit:q,formState:{errors:l},watch:C,control:D,setValue:f,getValues:M}=W({resolver:Y(ee),defaultValues:{color:t?.color||[],category:t?.category?.map(a=>a.name)||[],isAvailable:t?.isAvailable??!0,features:t?.features||[],image:t?.image||[]}}),p=C("color"),$=C("category"),S=(a,s)=>{const n=M(a)||[],c=n.includes(s)?n.filter(_=>_!==s):[...n,s];f(a,c)},z=a=>{N(s=>[...s,a]),f("image",[...d,a]),j(s=>s.slice(1))},E=a=>{const s=Array.from(a.target.files),n=5-d.length;if(s.length>n){g({variant:"destructive",title:"Too many images",description:`You can only upload ${n} more images.`});return}j(c=>[...c,...s]),v(!0)},R=a=>{const s=d.filter((n,c)=>c!==a);N(s),f("image",s)};o.useEffect(()=>{(async()=>{try{const s=await A.get("/category");k(s.data.categories||[])}catch(s){console.error("Error fetching categories:",s)}})()},[]);const{fields:U,append:L,remove:T}=G({name:"features",control:D}),B=async a=>{y(!0);try{a.features&&(a.features=a.features.filter(c=>c.name.trim()&&c.detail.trim()));const s=t?`/product/${t?._id}`:"/product";await A[t?"put":"post"](s,{...a}),g({variant:"primary",description:x==="create"?"Product created successfully!":"Product updated successfully!"})}catch(s){console.error("Submission error:",s),g({variant:"destructive",title:"Operation failed!",description:s.response?.data?.message||"Something went wrong"})}finally{y(!1)}},X=x==="create"?"Add New Product":"Edit Product Details";return e.jsx("form",{className:"flex flex-col gap-8 p-8 mt-48 bg-white",onSubmit:q(B),children:e.jsxs("div",{className:"overflow-y-scroll flex flex-col gap-8 pt-48 w-full",children:[e.jsx("h1",{className:"text-xl font-semibold",children:X}),e.jsxs("div",{className:"flex justify-between flex-wrap gap-4",children:[e.jsx(m,{label:"Product Name",name:"name",register:r,error:l?.name,defaultValue:t?.name}),e.jsx(m,{label:"Brand",name:"brandId",register:r,error:l?.brand,defaultValue:t?.brand}),e.jsx(m,{label:"Delivery Days",name:"deliveryDays",type:"number",register:r,error:l?.deliveryDays,defaultValue:t?.deliveryDays}),e.jsx(m,{label:"Actual Price ($)",name:"actualPrice",type:"number",step:"0.01",register:r,error:l?.actualPrice,defaultValue:t?.actualPrice}),e.jsx(m,{label:"Selling Price ($)",name:"sellingPrice",type:"number",step:"0.01",register:r,error:l?.sellingPrice,defaultValue:t?.sellingPrice}),e.jsxs("div",{className:"flex flex-col gap-2 w-full md:w-1/4",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Size"}),e.jsx("select",{className:"ring-[1.5px] ring-gray-300 p-2 rounded-md text-sm w-full",...r("size"),defaultValue:t?.size,children:["S","M","L","XL","XXL"].map(a=>e.jsx("option",{value:a,children:a},a))}),l.size?.message&&e.jsx("p",{className:"text-xs text-red-400",children:l.size.message.toString()})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:I.map(a=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg bg-gray-100",children:[e.jsx("input",{type:"checkbox",value:a.name,checked:$?.includes(a.name),onChange:()=>S("category",a.name),className:"w-4 h-4 accent-teal-700"}),e.jsx("span",{className:"text-sm",children:a.name})]},a._id))}),l.category?.message&&e.jsx("p",{className:"text-xs text-red-800",children:l.category.message.toString()})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Colors"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:H.filter(Boolean).map(a=>e.jsxs("label",{className:"relative flex flex-col items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",value:a.name,checked:p?.includes(a.name),onChange:()=>S("color",a.name),className:"absolute opacity-0 h-0 w-0"}),e.jsx("div",{className:`w-10 h-10 rounded-2xl border-2 flex items-center justify-center
                      ${p?.includes(a.name)?"border-teal-700 ring-2 ring-teal-200":"border-gray-200"}`,style:{backgroundColor:a.name==="Multicolor"?void 0:a.hex,backgroundImage:a.name==="Multicolor"?"linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #00ffff, #0000ff, #8000ff, #ff0080)":void 0},children:e.jsx("span",{className:`text-lg font-bold ${["White","Multicolor"].includes(a.name)?"text-gray-700":"text-white"}`,children:p?.includes(a.name)&&"✓"})}),e.jsx("span",{className:"text-xs text-gray-600 capitalize",children:a.name.toLowerCase()})]},a.name))}),l.color?.message&&e.jsx("p",{className:"text-xs text-red-400",children:l.color.message.toString()})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Features (optional)"}),U.map((a,s)=>e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsx(m,{label:"Feature Name",name:`features.${s}.name`,register:r,error:l.features?.[s]?.name,className:"flex-1"}),e.jsx(m,{label:"Feature Detail",name:`features.${s}.detail`,register:r,error:l.features?.[s]?.detail,className:"flex-1"}),s>0&&e.jsx("button",{type:"button",onClick:()=>T(s),className:"text-red-500 text-sm mb-2",children:"Remove"})]},a.id)),e.jsx("button",{type:"button",onClick:()=>L({name:"",detail:""}),className:"text-teal-700 text-sm mt-2 self-start",children:"+ Add Feature"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("input",{type:"checkbox",id:"isAvailable",...r("isAvailable"),className:"h-4 w-4 text-teal-700 focus:ring-teal-700 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isAvailable",className:"text-sm text-gray-700",children:"Product Available"})]}),e.jsx(Z,{label:"Description",name:"desc",register:r,error:l?.desc,defaultValue:t?.desc,className:"w-full"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Product Images (Max 5)"}),e.jsx("input",{type:"file",ref:w,multiple:!0,accept:"image/*",onChange:E,className:"hidden"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[d.map((a,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a,alt:`Product preview ${s+1}`,className:"w-32 h-32 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>R(s),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:"×"})]},a)),d.length<5&&e.jsx("button",{type:"button",onClick:()=>w.current.click(),className:"w-32 h-32 border-2 border-dashed rounded-lg flex items-center justify-center text-gray-500 hover:border-teal-500 hover:text-teal-500 transition-colors",children:"Add Image"})]}),l.image?.message&&e.jsx("p",{className:"text-xs text-red-500",children:l.image.message})]}),e.jsx(J,{isOpen:V,onClose:()=>v(!1),onUploadComplete:z,queue:F})]}),e.jsx("button",{className:"bg-teal-700 hover:bg-teal-700/90 text-white p-2 rounded-md",type:"submit",disabled:b,children:b?"Submitting...":x==="create"?"Create Product":"Update Product"})]})})};export{re as default};
