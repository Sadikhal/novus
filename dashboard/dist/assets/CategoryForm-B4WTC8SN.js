import{f as M,r as o,u as R,a as E,b as F,j as e,I as k,c as q,o as A,i as $,d as O,s as h}from"./index-BeksSBPr.js";const Q=A({name:h().min(3,{message:"Category name must be at least 3 characters!"}).max(8,{message:"Category name must be at most 8 characters!"}),image:O(h()).min(1,"At least one image is required").max(5,"Maximum 5 images allowed")}),_=({type:T,data:s})=>{const y=M(),[m,d]=o.useState(!1),{toast:n}=R(),[b,g]=o.useState([]),[j,u]=o.useState(!1),[r,p]=o.useState(s?.image||[]),x=o.useRef(null),{register:v,handleSubmit:C,reset:w,formState:{errors:c},setValue:f}=E({resolver:F(Q),defaultValues:{name:s?.name||"",image:s?.image||[]}});o.useEffect(()=>{f("image",r)},[r,f]);const N=a=>{p(t=>[...t,a]),g(t=>t.slice(1))},S=a=>{const t=Array.from(a.target.files),l=5-r.length;if(t.length>l){n({variant:"destructive",title:"Too many images",description:`You can only upload ${l} more images.`});return}g(i=>[...i,...t]),u(!0)},I=a=>{const t=r.filter((l,i)=>i!==a);p(t)},U=async a=>{d(!0);try{const t=s?`/category/${s?._id}`:"/category",i=await $[s?"put":"post"](t,a);n({variant:"primary",description:s?"Category updated successfully!":"Category created successfully!"}),w(),y(0)}catch(t){n({variant:"destructive",title:"Operation failed!",description:t.response?.data?.message||"Something went wrong"})}finally{d(!1)}};return e.jsx("form",{className:"flex flex-col gap-8 p-2 px-2",onSubmit:C(U),children:e.jsxs("div",{className:"bg-[#fff] flex flex-col gap-8 w-full px-5",children:[e.jsx("h1",{className:"text-xl pt-5 font-semibold",children:s?"Edit Category":"Add New Category"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(k,{label:"Category Name",name:"name",register:v,error:c?.name}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category Images (Max 5)"}),e.jsx("input",{type:"file",ref:x,multiple:!0,accept:"image/*",onChange:S,className:"hidden"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[r.map((a,t)=>e.jsxs("div",{className:"relative group border border-slate-300 p-2 rounded-lg",children:[e.jsx("img",{src:a,alt:`Preview ${t+1}`,className:"w-32 h-32 object-cover rounded-md"}),e.jsx("button",{type:"button",onClick:()=>I(t),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:"Ã—"})]},a)),r.length<5&&e.jsx("label",{onClick:()=>x.current.click(),className:"cursor-pointer flex items-center justify-center rounded-md bg-white hover:bg-gray-100 relative w-36 h-36 border-2 border-dashed text-gray-500 hover:border-teal-500 hover:text-teal-500 transition-colors",children:e.jsx("img",{src:"/images/model.png",className:"w-9 h-9 object-cover",alt:"Upload"})})]}),c.image?.message&&e.jsx("p",{className:"text-xs text-red-500",children:c.image.message})]}),e.jsx(q,{isOpen:j,onClose:()=>u(!1),onUploadComplete:N,queue:b})]}),e.jsx("button",{className:"bg-teal-700 hover:bg-teal-700/90 text-white p-2 rounded-md",type:"submit",disabled:m,children:m?"Submitting...":s?"Update Category":"Create Category"})]})})};export{_ as default};
